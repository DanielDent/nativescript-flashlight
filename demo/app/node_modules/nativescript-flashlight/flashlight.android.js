var application = require("application");
var flashlight = require("./flashlight-common");
var camera;
var parameters;

flashlight.isAvailable = function() {
	var packageManager = application.android.currentContext.getPackageManager();
	return packageManager.hasSystemFeature(android.content.pm.PackageManager.FEATURE_CAMERA_FLASH);
}
flashlight.on = function() {
	this._checkAvailability();
	camera = android.hardware.Camera.open();
	parameters = camera.getParameters();

	console.log(android.hardware.Camera); // defined
	console.log(android.hardware.Camera.Parameters); // undefined, API level 22 problem?

	parameters.setFlashMode(android.hardware.Camera.Parameters.FLASH_MODE_TORCH); // boom
	camera.setParameters(parameters);
	camera.startPreview();
};
flashlight.off = function() {
	parameters.setFlashMode(android.hardware.Camera.Parameters.FLASH_MODE_OFF);
	camera.setParameters(parameters);
	camera.stopPreview();
};

module.exports = flashlight;
